// JavaScript Document
(function ($) {
    $.fn.Selectyze = function (opt,id) {
        var defaults = {
            theme: 'css3',
            effectOpen: 'show',
            effectClose: 'hide'
        };
        if (this.length) return this.each(function () {
            var opts = $.extend(defaults, opt),
                $this = $(this),
                optionselected = $this.find('option').filter(':selected'),
                DivSelect = $('<div>', {
                    'class': 'DivSelectyze ' + opts.theme + ''
                }),
                UlSelect = $('<ul>', {
                    'class': 'UlSelectize'
                }),
                liHtml = '';
            zIndex = 99;
            constructList($this);
            $this.hide();
            $this.after(DivSelect);
            if(id==undefined){
            	DivSelect.html('<input type="text" rel="' + optionselected.val() + '" class="selectyzeValue" value="' +optionselected.text()+ '">');
            }else{
            	DivSelect.html('<input id="'+id+'" type="text" rel="' + optionselected.val() + '" class="selectyzeValue" value="' +optionselected.text()+ '">');
            }
            UlSelect.appendTo(DivSelect).html(liHtml);
            $('.DivSelectyze').each(function (i, el) {
                    $(this).css('z-index', zIndex);
                    zIndex -= 10
                });
            n = false;
            DivSelect.mouseenter(function () {
                    n = false
                }).mouseleave(function () {
                    n = true
                });
            DivSelect.find('input.selectyzeValue').click(function (e) {
            		$('.DivSelectyze').css('z-index','89');
            		$('.choose_div').css('display','none');
            		$('.div_form_content').css({'position':'static','z-index':'0'});
            		$(this).closest('.DivSelectyze ').css('z-index','9999');
                    e.preventDefault();
                    closeList($('ul.UlSelectize').not($(this).next()));
                    
                    openList($(this).next('ul.UlSelectize'))
                });
            UlSelect.find('a').click(function (e) {
                    e.preventDefault();
                    DivSelect.find('input.selectyzeValue').val($(this).text());
                    $this.val($(this).attr('rel'));
                    $this.trigger('change');
                    closeList($this.next().find('.UlSelectize'));
                    DivSelect.find('input.selectyzeValue').closest('.DivSelectyze ').css('z-index','89');
                });
            $(document).click(function (e) {
            	if(n==true){
            		//alert(1)
            		$('.DivSelectyze').css('z-index','89');
            		$('.UlSelectize').css('display','none');
            	}else if(n==false){
            		//alert(2)
            	}else{
            		//alert(3)
            	}
                   //if (n) closeList($('.UlSelectize').not(':hidden'));
                    //DivSelect.find('input.selectyzeValue').closest('.DivSelectyze ').css('z-index','89');
                });

            function constructList(el) {
                    if (el.has('optgroup').length) {
                        el.find('optgroup').each(function (i, el) {
                            liHtml += '<li><span class="optgroupTitle">' + $(this).attr('label') + '</span><ul>';
                            $(this).children().each(function (i, el) {
                                liHtml += '<li><a rel="' + $(this).val() + '" href="#">' + $(this).text() + '</a></li>'
                            });
                            liHtml += '</ul></li>'
                        })
                    } else {
                        el.find('option').each(function (i, el) {
                            liHtml += '<li><a rel="' + $(this).val() + '" href="#">' + $(this).text() + '</a></li>'
                        })
                    }
                }
            function openList(el) {
                    switch (opts.effectOpen) {
                    case 'slide':
                        if (!el.is(':hidden')) el.stop(true, true).show();
                        else el.stop(true, true).hide();
                        break;
                    case 'fade':
                        if (!el.is(':hidden')) el.stop(true, true).hide();
                        else el.stop(true, true).show();
                        break;
                    default:
                        if (!el.is(':hidden')) el.stop(true, true).hide();
                        else el.stop(true, true).show()
                    }
                }
            function closeList(el) {
                    switch (opts.effectClose) {
                    case 'slide':
                        el.stop(true, true).show();
                        break;
                    case 'fade':
                        el.stop(true, true).hide();
                        break;
                    default:
                        el.hide()
                    }
                }
        })
    }
})(jQuery);